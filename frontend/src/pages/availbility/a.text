Perfect ğŸ‘
Kal ka task **bilkul clear** hai aur tum already **right mental model** pe ho.
Ab main tumhe **exact kya banana hai, kaise banana hai, aur kya avoid karna hai** woh crisp plan de raha hoon. Isse tum bina bhatke implement kar loge.

---

## ğŸ¯ Kal ka goal (one line)

**Ek READ-ONLY API banana hai jo bataye:**

* property kab âŒ unavailable hai (owner block)
* kab âŒ sold out hai (capacity = 0)
* kab âš ï¸ limited hai
* kab âœ… fully available hai

ğŸ‘‰ **Availability + Capacity combined view**, railway style.

---

## ğŸ§  Sabse pehle thinking clear karo (non-negotiable)

### Truth sources

* **Availability table** â†’ hard block (owner intent)
* **Booking table** â†’ capacity consumption
* **Property table** â†’ max capacity

âš ï¸ Is API me:

* âŒ koi DB write nahi
* âŒ koi block create nahi
* âŒ koi cron nahi

Sirf **calculation**.

---

## âœ… API design (clean & interview-safe)

### Endpoint

```
GET /property/:id/availability-summary
```

### Query params

```
?startDate=2026-02-01
&endDate=2026-02-10
```

---

## ğŸ” API ka step-by-step logic (this is the solution)

### 1ï¸âƒ£ Validate input

* startDate < endDate
* valid date
* range limit (e.g. max 30 or 60 days)

This prevents heavy queries.

---

### 2ï¸âƒ£ Property fetch

* `capacity`
* `status`

Agar property inactive:

* return empty / unavailable response

---

### 3ï¸âƒ£ Availability (hard blocks) fetch

From `propertyAvailability`:

Condition:

```
propertyId
startTime < endDate
endTime > startDate
```

ğŸ‘‰ Isse tumhe **blocked ranges** mil jaayenge.

---

### 4ï¸âƒ£ Booking aggregation (capacity logic)

From `booking` table:

Conditions:

* `status = CONFIRMED`
* overlapping date range

Tum already yeh overlap logic likh chuke ho ğŸ‘

Is data se:

* per-day capacity used calculate karni hai
  (ya per-range simplified version)

---

### 5ï¸âƒ£ Per-day decision engine (core logic ğŸ”¥)

Har date ke liye yeh order follow karo:

1. **Owner block hai?**

   * Yes â†’ âŒ `UNAVAILABLE`
2. **Remaining capacity = 0?**

   * Yes â†’ âŒ `SOLD_OUT`
3. **Remaining < max?**

   * Yes â†’ âš ï¸ `LIMITED`
4. Else

   * âœ… `AVAILABLE`

âš ï¸ Isko **DB me store nahi karna**
Isko **response me compute karna**.

---

## ğŸ“¦ Suggested response shape (frontend-friendly)

Conceptually something like:

```json
{
  "propertyId": "abc",
  "capacity": 5,
  "range": {
    "start": "2026-02-01",
    "end": "2026-02-10"
  },
  "calendar": [
    {
      "date": "2026-02-01",
      "status": "AVAILABLE",
      "remainingCapacity": 5
    },
    {
      "date": "2026-02-02",
      "status": "LIMITED",
      "remainingCapacity": 2
    },
    {
      "date": "2026-02-03",
      "status": "SOLD_OUT",
      "remainingCapacity": 0
    },
    {
      "date": "2026-02-04",
      "status": "UNAVAILABLE",
      "remainingCapacity": 0
    }
  ]
}
```

Frontend ko **zero extra logic** chahiye.

---

## ğŸ§¯ What NOT to do (important)

Kal yeh sab mat karna:

* âŒ capacity full hone pe availability block create karna
* âŒ cron se availability sync karna
* âŒ booking confirm pe availability write karna

Yeh sab **derived state ko persist** karne ke sins hain.

---

## ğŸ” Race condition angle (tumne already pooch liya tha)

Good news:

* Yeh summary API **race-free** hai
* Kyunki:

  * Read-only
  * Transaction ki zarurat nahi

Race sirf **booking create** me hoti hai
Summary API sirf â€œcurrent snapshotâ€ dikhati hai.

---

## ğŸ—‚ï¸ Kal ka execution order (follow this)

### Step 1

Availability overlap query implement karo

### Step 2

Booking overlap + capacity aggregation reuse karo

### Step 3

Per-day loop bana ke status derive karo

### Step 4

Clean response return karo

Bas.

---

## ğŸ§  Senior mental model (yaad rakhna)

> Booking API decides **can I book now**
> Availability Summary API answers **what does the calendar look like**

Tum dono ko alag rakh rahe ho â†’ system stable rahega.

---

## Final verdict

Tum ab **real booking engine** bana rahe ho, CRUD nahi.
Kal ka kaam complete hua to:

* payment integrate karna safe hoga
* overbooking control me rahegi
* calendar UX crystal clear hoga

Kal yeh API ban jaaye â†’
tum system-design interview ke **strong zone** me aa jaoge ğŸš€

Aur routine reminder ğŸ˜„
**Did you solve any DSA question today?**
